(function(){var a={Result:{s:1,n:2,c:3,p:4},Error:{i:1,p:2,tr:4},a:"*",as:"async",d:false,init:function(e,f){var j={},h=e.terminal||e["final"],k=f||e.machine||{},m=e.events||[],i=e.callbacks||{},c={},g={};if(typeof e.initial=="string"){j={state:e.initial}}else{j=e.initial}var l=function(o){var q=(o.from instanceof Array)?o.from:(o.from?[o.from]:[a.a]);c[o.event]=c[o.event]||{};for(var p=0;p<q.length;p++){g[q[p]]=g[q[p]]||[];g[q[p]].push(o.event);c[o.event][q[p]]=o.to||q[p]}};if(j){j.event=j.event||"startup";l({event:j.event,from:"none",to:j.state})}for(var d=0;d<m.length;d++){l(m[d])}for(var b in c){if(c.hasOwnProperty(b)){k[b]=a.buildEvent(b,c[b])}}for(var b in i){if(i.hasOwnProperty(b)){k[b]=i[b]}}k.current="none";k.is=function(n){return(n instanceof Array)?(n.indexOf(this.current)>=0):(this.current===n)};k.can=function(n){return !!(!this.transition&&c[n]&&(c[n].hasOwnProperty(this.current)||c[n].hasOwnProperty(a.a)))};k.cannot=function(n){return !this.can(n)};k.next=function(){return g[this.current]};k.finished=function(){return this.is(h)};k.debug=function(n){return a.debug(n)};k.error=e.error||function(p,t,s,o,n,r,q){throw q||r};if(j&&!j.defer){k[j.event]()}return k},callback:function(c,f,d,i,h,b){if(f){try{return f.apply(c,[d,i,h].concat(b))}catch(g){return c.error(d,i,h,b,a.Error.i,"an exception occurred in a caller-provided callback function",g)}}},anyEventBefore:function(c,d,f,e,b){if(a.d){console.log("anyEventBefore",d)}return a.callback(c,c.onbeforeevent,d,f,e,b)},anyEventAfter:function(c,d,f,e,b){if(a.d){console.log("anyEventAfter",d)}return a.callback(c,c.onafterevent||c.onevent,d,f,e,b)},stateLeaveAny:function(c,d,f,e,b){if(a.d){console.log("stateLeaveAny",d)}return a.callback(c,c.onleavestate,d,f,e,b)},stateEnterAny:function(c,d,f,e,b){if(a.d){console.log("stateEnterAny",d)}return a.callback(c,c.onenterstate||c.onstate,d,f,e,b)},changeState:function(c,d,f,e,b){if(a.d){console.log("changeState",d)}return a.callback(c,c.onchangestate,d,f,e,b)},thisEventBefore:function(c,d,f,e,b){if(a.d){console.log("thisEventBefore",d)}return a.callback(c,c["onbefore"+d],d,f,e,b)},thisEventAfter:function(c,d,f,e,b){if(a.d){console.log("thisEventAfter",d)}return a.callback(c,c["onafter"+d]||c["on"+d],d,f,e,b)},leaveThisState:function(c,d,f,e,b){if(a.d){console.log("leaveThisState",d)}return a.callback(c,c["onleave"+f],d,f,e,b)},enterThisState:function(c,d,f,e,b){if(a.d){console.log("enterThisState",d)}return a.callback(c,c["onenter"+e]||c["on"+e],d,f,e,b)},beforeEvent:function(c,d,f,e,b){if((false===a.thisEventBefore(c,d,f,e,b))||(false===a.anyEventBefore(c,d,f,e,b))){return false}},afterEvent:function(c,d,f,e,b){a.thisEventAfter(c,d,f,e,b);a.anyEventAfter(c,d,f,e,b)},enterState:function(c,d,f,e,b){a.enterThisState(c,d,f,e,b);a.stateEnterAny(c,d,f,e,b)},leaveState:function(e,f,h,g,d){var c=a.leaveThisState(e,f,h,g,d),b=a.stateLeaveAny(e,f,h,g,d);if((false===c)||(false===b)){return false}else{if((a.as===c)||(a.as===b)){return a.as}}},debug:function(b){a.d=b;return a.d},buildEvent:function(b,c){return function(){var h=this.current;var g=c[h]||c[a.a]||h;var e=Array.prototype.slice.call(arguments);if(this.transition){return this.error(b,h,g,e,a.Error.p,"event "+b+" inappropriate because previous transition did not complete")}if(this.cannot(b)){return this.error(b,h,g,e,a.Error.i,"event "+b+" inappropriate in current state "+this.current)}if(false===a.beforeEvent(this,b,h,g,e)){return a.Result.c}if(h===g){a.afterEvent(this,b,h,g,e);return a.Result.n}var f=this;this.transition=function(){f.transition=null;f.current=g;a.enterState(f,b,h,g,e);a.changeState(f,b,h,g,e);a.afterEvent(f,b,h,g,e);return a.Result.s};this.transition.cancel=function(){f.transition=null;a.afterEvent(f,b,h,g,e)};var d=a.leaveState(this,b,h,g,e);if(false===d){this.transition=null;return a.Result.c}else{if(a.as===d){return a.Result.p}else{if(this.transition){return this.transition()}}}}}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=a}exports.eventum=a}else{if(typeof define==="function"&&define.amd){define(function(b){return a})}else{if(typeof window!=="undefined"){window.eventum=a}else{if(typeof self!=="undefined"){self.eventum=a}}}}}());